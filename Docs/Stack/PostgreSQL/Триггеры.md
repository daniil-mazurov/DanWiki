[Источник](https://selectel.ru/blog/tutorials/trigger-postgresql/)
[Примеры](https://postgrespro.ru/docs/postgrespro/15/plpgsql-trigger?lang=en)
# Базовый синтаксис создания триггерной функции

```sql
CREATE FUNCTION <имя_функции>() RETURNS trigger AS
$$
	BEGIN
		<тело функции>     
	RETURN [NEW|OLD|NULL];
	END; 
$$ 
LANGUAGE plpgsql;`
```

Триггерная функция должна возвращать тип TRIGGER и объявляться без аргументов. Внутри нее можно использовать переменные **NEW**, **OLD** и другие — полный список в источнике.

Функция, вызываемая для строки, может возвращать следующие значения: NULL, OLD или NEW.

Триггерные функции, вызываемые для операторов (FOR EACH STATEMENT), должны возвращать NULL.

Переменная NEW хранит строку после выполнения операции, а OLD — до.

**RETURN NULL**:
- для триггерных функций, выполняемых после операции (AFTER), возвращаемые значения игнорируются;
- если функция, выполняемая до операции со строкой (BEFORE), возвращает NULL, то такая строка пропускается. Операция по изменению, обновлению или удалению с ней не выполняется. При этом выполнение транзакции не прерывается.

**RETURN OLD**. Триггерные функции, выполняемые до (BEFORE) операции DELETE, должны возвращать исходную строку (OLD), если операцию удаления со строкой нужно выполнить. Если же ее нужно пропустить, возвращается NULL.

**RETURN NEW**. Функции, выполняемые до (BEFORE) операции INSERT или UPDATE, должны возвращать новую или обновленную строку, которая будет добавлена в таблицу.

Пример создания триггерной функции:

```sql
CREATE FUNCTION salary_check() RETURNS trigger AS 
$salary_check$
BEGIN         
	IF NEW.salary IS NULL THEN
		RAISE EXCEPTION '% Нужно указать зарплату', NEW.name;
	END IF;
	IF NEW.salary < 0 THEN
		RAISE EXCEPTION '% Зарплата должна быть больше нуля', NEW.name;
	END IF;
	RETURN NEW;
END; 
$salary_check$ 
LANGUAGE plpgsql;
```

Для триггеров, выполняемых до операций INSERT или UPDATE для строки, удобно внутри триггерной функции работать с переменной NEW. Прямо в ней производить изменения и по выполнении возвращать измененную строку NEW. Если функция не изменяет результат операции со строкой, то нужно вернуть NEW.