>[!important] imports
>```python
>from sqlalchemy import Table, Column, Integer, String, MetaData
>from sqlalchemy.orm import DeclarativeBase
>from sqlalchemy.orm import Mapped, mapped_column
>```

**Объявление таблицы происходит через запись в метаданные:**
- Императивный стиль:
```python
metadata_obj = MetaData()
"""Метаданные о создаваемых таблицах"""


my_table = Table(
	"tablename",
	metadata_obj,
	Column("id", Integer, primary_key=True),
	Column("first_col", String),
)
```
- Декларативный стиль:
```python
class Base(DeclarativeBase):
	'''Хранилище метаданных'''
	pass

class ExampleTable(Base):
	__tablename__ = "tablename"
	
	id: Mapped[int] = mapped_column(primary_key=True)
	first_col: Mapped[str]
```
#### metadata_obj.create_all(engine)
	Создание (CREATE TABLE) всех объявленных в метаданных таблиц
- engine - [[Подключение к БД#^24ea83]]]
#### metadata_obj.drop_all(engine)
	 Удаление(DROP TABLE) всех объявленных в метаданных таблиц
- engine - [[Подключение к БД#^24ea83]]]

>[!info]
>В декларативном стиле доступ к метаданным можно получить через `Base.metadata`
#### Mapped
- Описание структур данных для создаваемых структур и объектов в базе
##### mapped_column()
- Инструмент для задания параметров объектам данных Mapped
# Типы данных
>[!important] imports
>```python
>import enum
>from typing import Annotated
>from datetime import datetime
>
>from sqlalchemy import Table, Column, Integer, String, MetaData, Enum, DateTime, ForeignKey, func, text, 
>from sqlalchemy.orm import Mapped, mapped_column
>```
## Первичный ключ
- Императивный стиль:
```python
Column("id", Integer, primary_key=True)
```

- Декларативный стиль:
```python
id: Mapped[int] = mapped_column(primary_key=True)
```
## string, integer ...
- Императивный стиль:
```python
Column("first_col", String(50), nullable=False)
# Поле nullable по умолчанию имеет значение True
```

- Декларативный стиль:
```python
first_col: Mapped[str | None] = mapped_column(String(50))
# str | None Напротив добавляет параметру возможность быть нулевым
```

>[!info]
>`String(50)` означает строковый тип данных с ограничением по количеству символов равным 50

## enum
- Императивный стиль:
```python
Column(
	"enum_val",
	Enum(_ExampleEnum, values_callable=lambda obj: [e.value for e in obj]),
)
```

- Декларативный стиль:
```python
enum_val: Mapped[_ExampleEnum] = mapped_column(
	Enum(_ExampleEnum, values_callable=lambda obj: [e.value for e in obj])
)
```

`values_callable=lambda obj: [e.value for e in obj]` - Позволяет ввести в базу значения атрибутов, а не их имена

>[!info]- `_ExampleEnum` - класс для создания **Enum**
>```python
>class _ExampleEnumDecl(enum.Enum):
>	first_var = "1"
>	second_var = "2"
>```
## time
- Императивный стиль:
```python
Column("date_val", DateTime, server_default=func.now())
```

- Декларативный стиль:
```python
date_val: Mapped[datetime] = mapped_column(server_default=func.now())
```
### server_default, default
Параметр типов данных задающий значение по умолчанию параметрам
- server_default - Значение по умолчанию получает база данных в результате выполнения команды.
	Например:
	- _server_default_ = **func.now()** - команда `now()` на языке SQL
	- _server_default_ = **text("TIMEZONE('utc',now())")** - аналог `now()`, но время по Гринвичу
- default - Значение по умолчанию получает интерпретатор Python, выполняя соответствующую функцию (либо передавая статичное значение)
	- _default_ = datetime.now
	- _default_ = 1
## Внешние ключи
- Императивный стиль:
```python
Column(
	"foreign_val", Integer, ForeignKey("tablename.id", ondelete="CASCADE"),
)
```

- Декларативный стиль:
```python
foreign_val: Mapped[int | None] = mapped_column(
	ForeignKey("tablename.id", ondelete="CASCADE"),
)
```

-  Параметр `ondelete` задает поведение при удалении значения, на которое ссылается ключ, например:
	- `CASCADE` - каскадное удаление всех строк, имеющих этот внешний ключ
	- `SET NULL` - обнуление ключа
- `tablename.id` - название таблицы и параметр, на который ссылается ключ
## Кастомные типы
Кастомные (пользовательские) типы данных позволяют жестко задать параметры типам данных
```python
intpk = Annotated[int, mapped_column(primary_key=True)]
str_256 = Annotated[str, 256]


class ExampleTypes(Base):
__tablename__ = "types_examples"
	
	id: Mapped[intpk]
	maybe_none_val: Mapped[str_256 | None]
```
